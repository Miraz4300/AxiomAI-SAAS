version: '3'

services:
  app:
    image: miraz4300/axiomai:latest
    container_name: AxiomAI
    restart: always
    ports:
      - 10829:10829
    environment:
      TZ: Asia/Dhaka

      # Debug Mode | set 'true' to disable debug mode
      DISABLE_DEBUG:

      # Rate Limit | Default: 0 (unlimited)
      MAX_REQUEST_PER_HOUR:

      # Auth Rate Limit
      AUTH_MAX_REQUEST_PER_MINUTE:

      # MONGODB_URL=mongodb://username:password@hostname:port
      MONGODB_URL: ''

      # ----- Only valid after setting AUTH_SECRET_KEY begin ----
      # JWT secret key | Empty key will disable authentication system
      AUTH_SECRET_KEY:

      # Allow anyone to signup
      REGISTER_ENABLED: false

      # Root user email
      ROOT_USER:

      # Password salt
      PASSWORD_MD5_SALT: anysalt

      # For text to speech
      # Azure Subscription Key
      AZURE_SUBSCRIPTION_KEY:

      # SPEECH_REGION
      AZURE_SPEECH_REGION:

      # DataDog APM
      DD_AGENT_HOST: datadog
      
    depends_on:
    - datadog

  # Nginx reverse proxy
  nginx:
    image: nginx:alpine
    container_name: NginxAxiomAI
    restart: always
    ports:
      - '443:443'
    expose:
      - '443'
    volumes:
      - nginxCONF:/etc/nginx # Needs to create nginxCONF volume manually
    links:
      - app

  # DataDog Agent
  datadog:
    image: datadog/agent:latest
    container_name: dd-agent
    restart: always
    environment:
     - DD_API_KEY=c3d42e730bcd04c437b6c64379eae78a
     - DD_SITE=datadoghq.com
     - DD_APM_ENABLED=true
     - DD_ENV="production"
     - DD_LOGS_INJECTION=true
     - DD_PROFILING_ENABLED=true
     - DD_APPSEC_ENABLED=true
    volumes:
     - /var/run/docker.sock:/var/run/docker.sock
     - /proc/:/host/proc/:ro
     - /sys/fs/cgroup:/host/sys/fs/cgroup:ro

volumes:
  nginxCONF:
    external: true
